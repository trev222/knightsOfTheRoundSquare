<!DOCTYPE html>
<head>
	<title></title>

	<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<!-- // <script type="text/javascript" src="/scripts/jquery-1.10.2.js"></script> -->
	<!-- // <script type="text/javascript" src="/scripts/1.11.0-jquery-ui.js"></script> -->
</head>



<style type="text/css">
	*{
		margin: 0px;padding: 0px;
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
	}
	.board{
		float: left;
		padding: 5px;
	}
	.board.success{
		background-color: rgba(0,255,0,.2);
	}
	.board.failed{
		background-color: rgba(255,0,0,.2);
	}
	.board.selected{
		background-color: rgba(255,255,0,.2);
	}
	.board.selected.success{
		box-shadow: inset 0px 0px 3px 5px rgba(0,255,0,.5);
	}
	.board.selected.failed{
		box-shadow: inset 0px 0px 3px 5px rgba(255,0,0,.5);
	}

	.box{
		margin: 3px;
		height: 20px; width: 20px;
		border: 1px solid black;
		float: left;
	}
	.box.on{
		background-color: blue;
	}
	.box.beenHereAlready{
		background-color: red;
	}
	.box.start{
		background-color: green;
	}
	.box.map{
		background-color: rgba(255,0,255,.4);
	}
	.box.active{
		border: 4px solid orange;
	}
</style>



<body>

	

</body>












<script type="text/javascript">

// ============================================================================================
// == General Start
// ============================================================================================
activeOpenBlockArray = [];
boardsToSplice = [];

function boardFinished(boardElementID){
	if(!$("#"+boardElementID+" .off").length && 
		!$("#"+boardElementID+" .beenHereAlready").length){
		console.log("Success! "+boardElementID+" has been completed!");
		$("#"+boardElementID).addClass("success");
	}else{
		console.log("Failed! "+boardElementID+" was not completed!");
		$("#"+boardElementID).addClass("failed");
	}
	//remove from progress array
	var index = activeBoards.indexOf(boardElementID);
	if (index > -1) {
		boardsToSplice.push(boardElementID);
    // activeBoards.splice(index, 1);
	}
}
function spliceFinishedBoards(){
	for (var i = 0; i < boardsToSplice.length; i++) {
		var board = boardsToSplice[i];

		var index = activeBoards.indexOf(board);
		if (index > -1) {
	    activeBoards.splice(index, 1);
		}
	};
}


function createBoard(boardElementID,height,width,startX,startY){
	activeBoards[activeBoards.length] = boardElementID;

	$('body').append('<div class="board" size="'+width+'x'+height+'" id="'+boardElementID+'"></div>');
	var w = 1,
			h = 1;
	while(h <= height){//height		
		w = 1;
		while(w <= width){//width
			$('#'+boardElementID).append('<div id="'+boardElementID+'-'+w+'-'+h+'" class="box off" x="'+w+'" y="'+h+'"></div>');
			w++;
		}
		$('#'+boardElementID).append('<div style="clear:both;"></div>');
		h++;
	}
	chooseStart(boardElementID,height,width,startX,startY);
}

function chooseStart(boardElementID,height,width,x,y){
	if(x == undefined){
		var x = parseInt(Math.floor((Math.random() * width) + 1));
	}
	if(y == undefined){
		var y = parseInt(Math.floor((Math.random() * height) + 1));
	}
	$('#'+boardElementID+'-'+x+'-'+y).addClass("start active on").removeClass("off");
	createActiveOpenBlockArray(boardElementID,x,y);
}

function createActiveOpenBlockArray(boardElementID,x,y){
	// console.log("Init: x:"+x+" y:"+y);
	activeOpenBlockArray[boardElementID] = [];

	var top_y = y-1;
	if($("#"+boardElementID+"-"+x+"-"+top_y).length){
		activeOpenBlockArray[boardElementID].push(x+"-"+top_y);
	}
	var bottom_y = y+1;
	if($("#"+boardElementID+"-"+x+"-"+bottom_y).length){
		activeOpenBlockArray[boardElementID].push(x+"-"+bottom_y);
	}
	var right_x = x+1;
	if($("#"+boardElementID+"-"+right_x+"-"+y).length){
		activeOpenBlockArray[boardElementID].push(right_x+"-"+y);
	}
	var left_x = x-1;
	if($("#"+boardElementID+"-"+left_x+"-"+y).length){
		activeOpenBlockArray[boardElementID].push(left_x+"-"+y);
	}
	
}



function moveToNext(boardElementID,direction){
	var x = $('#'+boardElementID+' .active').attr('x'),
			y = $('#'+boardElementID+' .active').attr('y');

	switch(direction){
		case "up": y--;break;
		case "down": y++;break;
		case "right": x++;break;
		case "left": x--;break;
		default:console.log("moveToNext(): direction not recognized: "+direction);break;
	}
	var removeFromActiveArray = x+"-"+y,
			removeFromActiveArrayIndex = activeOpenBlockArray[boardElementID].indexOf(removeFromActiveArray);
	if(removeFromActiveArrayIndex != -1){
		// console.log(activeOpenBlockArray[boardElementID]);
		activeOpenBlockArray[boardElementID].splice(removeFromActiveArrayIndex,1);
		// console.log("spliced: "+removeFromActiveArrayIndex);
		// console.log(activeOpenBlockArray[boardElementID]);
	}



	moveToThisElement = '#'+boardElementID+'-'+x+'-'+y;
	if(!$(moveToThisElement).length){
		console.log("moveToNext(): asked to move to this element but it doesn't exist: "+moveToThisElement);
		boardFinished(boardElementID);
		return;
	}
	if($(moveToThisElement).hasClass("on")){
		$(moveToThisElement).addClass("beenHereAlready");
		boardFinished(boardElementID);
	}
	if($(moveToThisElement).hasClass("start")){
		boardFinished(boardElementID);
	}

	$('#'+boardElementID+' .active').removeClass("active");
	$(moveToThisElement).addClass("active on").removeClass("off");
}



function doesBlockExist(boardElementID,x,y){
	if($("#"+boardElementID+"-"+x+"-"+y).length){
		return true;
	}
	return false;
}

function isBlockOpen(boardElementID,x,y){
	if($("#"+boardElementID+"-"+x+"-"+y).hasClass("off")){
		return true;
	}
	return false;
}
function blockIsOpenAndExists(boardElementID,x,y){
	if(doesBlockExist(boardElementID,x,y) && isBlockOpen(boardElementID,x,y)){
		return true;
	}
	return false;
}
// function isBlockStarter(boardElementID,x,y){
// 	if($("#"+boardElementID+"-"+x+"-"+y).hasClass("start")){
// 		return true;
// 	}
// 	return false;
// }

function blockHasClass(className,boardElementID,x,y){
	if($("#"+boardElementID+"-"+x+"-"+y).hasClass(className)){
		return true;
	}
	return false;
}

function onlyOneOpenBlockRemains(boardElementID){
	var count = $("#"+boardElementID+" .off").length;
	if(count <= 1){
		return true;
	}
	return false;
}




function viewBlockMoveOptions(boardElementID,x,y){
	// console.log("viewBlockMoveOptions x:"+x+" y:"+y);

	var data = [];
	for (var i = 0; i < 4; i++) {
		switch (i){
			case 0://up
				var pos = "up", cord = y,
						cordIncrementor = -1;
				break;
			case 1://down
				var pos = "down", cord = y,
						cordIncrementor = 1;
				break;	
			case 2://right
				var pos = "right"; cord = x,
						cordIncrementor = 1;
				break;
			case 3://left
				var pos = "left"; cord = x,
						cordIncrementor = -1;
				break;
			default:
				break;
		}

		data[pos] = []; 
		data[pos]['moveableAmount'] = 0;
		// data[pos]['ranIntoStartBlock'] = false;
		var checkPos = cord+cordIncrementor;
		
		n = 0; 
		max = maxMoveRange(boardElementID);
		while(n <= max){
			if(i == 0 || i == 1){//up or down
				console.log("pos: "+pos+" x:"+x+" checkPos(y): "+checkPos);
				if(!blockIsOpenAndExists(boardElementID,x,checkPos) || blockHasClass("map",boardElementID,x,checkPos)){
					break;
				}
			}else{//right or left
				console.log("pos: "+pos+" y:"+y+" checkPos(x): "+checkPos);
				if(!blockIsOpenAndExists(boardElementID,checkPos,y) || blockHasClass("map",boardElementID,checkPos,y)){
					break;
				}
			}			
			data[pos]['moveableAmount']++;
			checkPos += cordIncrementor;

			if(n >= 100){
				console.log("n is too long, increase if this is not an error: "+n);
				break;
			}
			n++;
		}	
	};
	return data;
}
// console.log(viewBlockMoveOptions(boardElementID,x,y));

function moveCordsOneBlock(dir,x,y){
	if(dir == "up"){
		y--;
	}else if(dir == "down"){
		y++;
	}else if(dir == "right"){
		x++;
	}else if(dir == "left"){
		x--;
	}else{
		console.log("moveCordsDirection() direction not recognized: "+dir);
	}
	// console.log("moveCordsOneBlock() dir:"+dir);
	return {"x":x,"y":y};
}

function getOppositeDirections(dir){
	// console.log("getOppositeDirections");
	// console.log("dir:"+dir);
	if(dir == "up"){
		var opp = "down",od1 = "right",od2 = "left";
	}else if(dir == "down"){
		var opp = "up",od1 = "right",od2 = "left";
	}else if(dir == "right"){
		var opp = "left", od1 = "up", od2 = "down";
	}else if(dir == "left"){
		var opp = "right", od1 = "up", od2 = "down";
	}else{
		console.log("getOppositeDirections() direction not recognized: "+dir); return	false;
	}
	// console.log("opp:"+opp);
	return {"opp":opp,"od1":od1,"od2":od2};
}

function boardTotalBlocks(boardElementID){
	var size = $('#'+boardElementID).attr('size'),
			sizeArray = size.split("x"),
			widthBlocks = parseInt(sizeArray[0]),
			heightBlocks = parseInt(sizeArray[1]),
			totalBlocks = widthBlocks*heightBlocks;
	return totalBlocks;
}

function maxMoveRange(boardElementID){
	var size = $('#'+boardElementID).attr('size'),
			sizeArray = size.split("x"),
			widthBlocks = parseInt(sizeArray[0]),
			heightBlocks = parseInt(sizeArray[1]);
	if(widthBlocks > heightBlocks){
		return widthBlocks;
	}else{
		return heightBlocks;
	}
}

function percentageOfTheBoardTraversed(boardElementID){
	var totalBlocks = boardTotalBlocks(boardElementID),
			onBlocks = $('#'+boardElementID+" .on").length,
			percentage = onBlocks/totalBlocks;
	return percentage;
}

// ============================================================================================
// == General End
// ============================================================================================
// == thinkTankBrainFood Start
// ============================================================================================

function closestMove(movesArray){
	bestMove = "none";
	n = 1;
	while(n <= 4){
		if(n == 1){
			var pos = "up";
		}else if(n == 2){
			var pos = "down";
		}else if(n == 3){
			var pos = "right";
		}else if(n == 4){
			var pos = "left";
		}else{n++;break;}
		if(movesArray[pos]['moveableAmount'] == 0){
			n++;continue;
		}
		if(bestMove == "none" || movesArray[pos]['moveableAmount'] < movesArray[bestMove]['moveableAmount']){
			// console.log("changing bestMove from "+bestMove+" to "+pos);
			// previousBest = bestMove;
			bestMove = pos;
		}
		n++;
	}
	return bestMove;
}

function isThisMoveOpenOnBothSides(boardElementID,dir,cur_x,cur_y){//Naked means, is it empty on 3 sides
	
	var nextMoveCords = moveCordsOneBlock(dir,cur_x,cur_y);

	var oppDirs = getOppositeDirections(dir);

	var od1_cords = moveCordsOneBlock(oppDirs['od1'],nextMoveCords['x'],nextMoveCords['y']);
	var od2_cords = moveCordsOneBlock(oppDirs['od2'],nextMoveCords['x'],nextMoveCords['y']);

	if(blockIsOpenAndExists(boardElementID,od1_cords["x"],od1_cords["y"]) &&
		blockIsOpenAndExists(boardElementID,od2_cords["x"],od2_cords["y"])){
		// console.log("TRUE move dir:"+dir+" cur_x:"+cur_x+" cur_y:"+cur_y);
		return true;
	}
	return false;
}

// them english skills payin off arent they
function mapStartToBlockHasNoLeftOvers(boardElementID,x,y){
	console.log("mapFromStartToThisBlock called: x:"+x+" y:"+y);
	var totalOffBlocks = $("#"+boardElementID+" .off").length;
	var map = [];


	var openBlockStartPosCords = activeOpenBlockArray[boardElementID][0],
			openBlockStartPosCordsSplit = openBlockStartPosCords.split("-"),
			openBlockStart_x = openBlockStartPosCords[0],
			openBlockStart_y = openBlockStartPosCords[1];

	map.push(openBlockStart_x+"-"+openBlockStart_y);
	$("#"+boardElementID+"-"+openBlockStart_x+"-"+openBlockStart_y).addClass("map");

	var	current_x = openBlockStart_x,
			current_y = openBlockStart_y,
			n = 0,
			totalBlocks = boardTotalBlocks(boardElementID);
	while(n <= totalBlocks){
		var options = viewBlockMoveOptions(boardElementID,current_x,current_y);
				console.log("options:");
				console.log(options);
		var bestMove = closestMove(options);
				console.log("bestMove:"+bestMove);
		var moveResults = moveCordsOneBlock(bestMove,current_x,current_y);
				console.log("moveResults:");
				console.log(moveResults);

		current_x = moveResults['x'],
		current_y	= moveResults['y'];
		var indexMe = current_x+"-"+current_y,
				index = map.indexOf(indexMe);
		if(map.indexOf(indexMe) == -1){
			map.push(indexMe);
			$("#"+boardElementID+"-"+current_x+"-"+current_y).addClass("map");
		}else{
			console.log("mapStartToBlockHasLeftOvers() asked to index something that's already here: newIndex:"+indexMe);
			console.log(map);
			return false;
		}

		//found our move to block cords
		if(x == new_x && y == new_y){
			break;
		}
		n++;
	}
	// $('#'+boardElementID+" .map").removeClass("map");
	if(map.length == totalOffBlocks){
		console.log("NoLeftOvers: totalOffBlocks:"+totalOffBlocks+" map.length:"+map.length);
		return true;
	}
	console.log("HasLeftOvers: totalOffBlocks:"+totalOffBlocks+" map.length:"+map.length);
	return false;

}

function willThisMoveBlockStarter(boardElementID,move){
	// console.log(activeOpenBlockArray[boardElementID]);

	


	// if(activeOpenBlockArray[boardElementID].length > 1){
	// 	return false;
	// }


	var x =	parseInt($("#"+boardElementID+" .active").attr('x')),
			y = parseInt($("#"+boardElementID+" .active").attr('y'));
	if(move == "up"){y--;
	}else if(move == "down"){y++;
	}else if(move == "right"){x++;
	}else if(move == "left"){x--;
	}else{
		console.log("willThisMoveBlockStarter() move not recognized: "+move);return;
	}
	mapStartToBlockHasNoLeftOvers(boardElementID,x,y);
	return false;

	if(mapStartToBlockHasNoLeftOvers(boardElementID,x,y)){
		return true;
	}

	// var foo = x+"-"+y;
	// if(activeOpenBlockArray[boardElementID].indexOf(foo) != -1){
	// 	if(!onlyOneOpenBlockRemains(boardElementID)){
	// 		return true;
	// 	}
	// }
	return false;
}



// ============================================================================================
// == thinkTankBrainFood End
// ============================================================================================
// == thinkTank Start
// ============================================================================================

function thinkTank(){
	for (var i = 0; i < activeBoards.length; i++) {


		var boardElementID = activeBoards[i],
				x = parseInt($('#'+boardElementID+" .active").attr('x')),
				y = parseInt($('#'+boardElementID+" .active").attr('y'));


		var results = viewBlockMoveOptions(boardElementID,x,y);
		// console.log(boardElementID);
		// console.log(results);
		
		var bestMove = "none";

		// If there's no moves or only one move, 
		// then it's quite obvious isn't it
		if(results['up']['moveableAmount'] == 0 &&
			results['down']['moveableAmount'] == 0 && 
			results['right']['moveableAmount'] == 0 &&
			results['left']['moveableAmount'] == 0)
		{
			if(results['up']['ranIntoStartBlock']){	bestMove = "up";
			}else if(results['down']['ranIntoStartBlock']){	bestMove = "down";
			}else if(results['right']['ranIntoStartBlock']){	bestMove = "right";
			}else if(results['left']['ranIntoStartBlock']){	bestMove = "left";
			}else{
				console.log('thinkTank():'+boardElementID+': has no where to move, finished');
				boardFinished(boardElementID);
				// i--;
				continue;
			}
		}else if(results['left']['moveableAmount'] == 0 && 
			results['down']['moveableAmount'] == 0 && 
			results['right']['moveableAmount'] == 0){
			var bestMove = "up";
		}else if(results['up']['moveableAmount'] == 0 && 
			results['left']['moveableAmount'] == 0 && 
			results['right']['moveableAmount'] == 0){
			var bestMove = "down";
		}else if(results['up']['moveableAmount'] == 0 && 
			results['left']['moveableAmount'] == 0 && 
			results['down']['moveableAmount'] == 0){
			var bestMove = "right";
		}else if(results['up']['moveableAmount'] == 0 && 
			results['down']['moveableAmount'] == 0 && 
			results['right']['moveableAmount'] == 0){
			var bestMove = "left";
		}



		if(bestMove == "none"){//bypass dis shiz for speedz
			bestMove = closestMove(results);
			

			var active_x = parseInt($("#"+boardElementID+" .active").attr('x')),
					active_y = parseInt($("#"+boardElementID+" .active").attr('y'));

			var percentage = percentageOfTheBoardTraversed(boardElementID);

			// if(isThisMoveOpenOnBothSides(boardElementID,bestMove,active_x,active_y) && percentage >= .20){
			// 	// console.log("open on both sides");
			// 	//look for other blocks that are naked, if any other block isn't naked pick it
			// 	var options = [];
			// 	for (var k = 1; k <= 4; k++) {
			// 		if(k == 1 && bestMove != "up"){
			// 			var option = "up";
			// 		}else if(k == 2 && bestMove != "down"){
			// 			var option = "down";
			// 		}else if(k == 3 && bestMove != "right"){
			// 			var option = "right";
			// 		}else if(k == 4 && bestMove != "left"){
			// 			var option = "left";
			// 		}else{
			// 			continue;
			// 		}
			// 		if(results[option]['moveableAmount'] != 0 && !isThisMoveOpenOnBothSides(boardElementID,option)){
			// 			options.push(option);
			// 		}
			// 	};
			// 	if(options.length == 1){
			// 		// console.log("changing bestMove to a closer item");
			// 		bestMove = options[0];
			// 	}else if(options.length == 2){

			// 		if(results[options[0]]['moveableAmount'] < results[options[1]]['moveableAmount']){
			// 			bestMove = options[0];
			// 		}else{
			// 			bestMove = options[1];
			// 		}
			// 		// console.log("rare:2 better options:pick the shorter option");
			// 		// console.log("chosen option: "+bestMove);
			// 	}else if(options.length == 2){
			// 		// console.log("all options are open, do nothing");
			// 	}
			// 	//else everybodies naked! move on
			// }

			if(willThisMoveBlockStarter(boardElementID,bestMove)){
				console.log("this move will block starter:"+bestMove);

				var oppDirArray = getOppositeDirections(bestMove);

				if(results[oppDirArray['opp']]['moveableAmount'] != 0){
					bestMove = oppDirArray['opp'];
					console.log("flipped:"+bestMove);
				}else{
					if(results[oppDirArray['od1']]['moveableAmount'] != 0 && results[oppDirArray['od2']]['moveableAmount'] != 0){
						if(results[oppDirArray['od1']]['moveableAmount'] < results[oppDirArray['od2']]['moveableAmount']){
							bestMove = oppDirArray['od1'];
							console.log("bestMove1:"+bestMove);
						}else{
							bestMove = oppDirArray['od2'];
							console.log("bestMove2:"+bestMove);
						}
					}else if(results[oppDirArray['od1']]['moveableAmount'] == 0){
						bestMove = oppDirArray['od2'];
						console.log("bestMove3:"+bestMove);
					}else if(results[oppDirArray['od2']]['moveableAmount'] == 0){
						bestMove = oppDirArray['od1'];
						console.log("bestMove4:"+bestMove);
					}
				}
			}

		}
		
		

		moveToNext(boardElementID,bestMove);
	};
	spliceFinishedBoards();
}




// ============================================================================================
// == thinkThank End
// ============================================================================================
// == Operators and inits Start
// ============================================================================================



thinkTankLoop_timer = 0;
function thinkTankLoop(){
	if(thinkTankLoop_timer == 0){
		console.log("thinkTank thinkTank think think think");
		thinkTankLoop_timer = 1;
		thinkTankLoop_timer = setInterval(function(){ 
			thinkTank();
		}, 200);
	}else{
		console.log("thinkTank tired");
		clearInterval(thinkTankLoop_timer);
		thinkTankLoop_timer = 0;
	}
}







activeBoards = [];

var height = 8,
		width = 8;


// createBoard("alpha",height,width,4,8);//broken
// createBoard("beta",height,width,4,1);//broken
// createBoard("charlie",height,width,5,8);//broken
// createBoard("delta",height,width,5,1);//broken

// createBoard("echo",height,width,3,2);//broken
// createBoard("foxtrot",height,width,6,2);//broken
// createBoard("omega",height,width,3,7);//broken
// createBoard("zeta",height,width,6,7);//broken

for (var i = 0; i < 1; i++) {
	var foo = "place"+i;
	createBoard(foo,height,width);
};


$('.board').on("click",function(){
	if($(this).hasClass("selected")){
		$('.board').removeClass("selected");
		return;
	}
	$('.board').removeClass("selected");
	$(this).addClass("selected");	
});
window.addEventListener("keydown", function(e) {
    if([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {
        e.preventDefault();
    }
}, false);

$('body').on("keyup",function(e){
	// console.log("received key: "+e.keyCode);
	switch(e.keyCode){
		case 32://space
			var direction = "space";
			break;
		case 93://command
			var direction = "command",
					selected = $('.selected').attr("id");
			break;
		case 39://right
			var direction = "right",
					selected = $('.selected').attr("id");
			break;
		case 37://left
			var direction = "left",
					selected = $('.selected').attr("id");
			break;
		case 38://up
			var direction = "up",
					selected = $('.selected').attr("id");
			break;
		case 40://down
			var direction = "down",
					selected = $('.selected').attr("id");
			break;
		default:
			return;
			break;
	}
	// console.log(direction);
	if(direction == "command"){
		thinkTank();
		return;
	}
	if(direction == "space"){
		thinkTankLoop();
		return;
	}
	if($('.selected').length){
		moveToNext(selected,direction);
	}
	
});





</script>
</html>













