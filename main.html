<!DOCTYPE html>
<head>
	<title>Knights of the round square</title>

	<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
</head>



<style type="text/css">
	*{
		margin: 0px;padding: 0px;
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
	}
	.board{
		float: left;
		padding: 5px;
	}
	.board.success{
		background-color: rgba(0,255,0,.2);
	}
	.board.failed{
		background-color: rgba(255,0,0,.2);
	}
	.board.selected{
		background-color: rgba(255,255,0,.2);
	}
	.board.selected.success{
		box-shadow: inset 0px 0px 3px 5px rgba(0,255,0,.5);
	}
	.board.selected.failed{
		box-shadow: inset 0px 0px 3px 5px rgba(255,0,0,.5);
	}

	.box{
		margin: 3px;
		height: 20px; width: 20px;
		border: 1px solid black;
		float: left;
	}
	.box.on{
		background-color: blue;
	}
	.box.beenHereAlready{
		background-color: red;
	}
	.box.start{
		background-color: green;
	}
	.box.traversedBlock{
		background-color: rgba(255,0,255,.4);
	}
	.box.active{
		border: 4px solid orange;
	}
	#playButton,#new{
		margin: 10px;
		width: 100%;
		max-width: 200px;
		height: 40px;
	}
</style>



<body>
	<button id="new">new</button>
	<button id="playButton">start/stop</button>
	

</body>



<script type="text/javascript">

// ============================================================================================
// == General Start
// ============================================================================================
activeOpenBlockArray = [];
boardsToSplice = [];

function boardFinished(boardElementID){
	if(!$("#"+boardElementID+" .off:not(.start)").length && 
		!$("#"+boardElementID+" .beenHereAlready:not(.start)").length){
		console.log("Success! "+boardElementID+" has been completed!");
		$("#"+boardElementID).addClass("success");
	}else{
		console.log("Failed! "+boardElementID+" was not completed!");
		$("#"+boardElementID).addClass("failed");
	}

	//remove from progress array
	var index = activeBoards.indexOf(boardElementID);
	if (index > -1) {
		boardsToSplice.push(boardElementID);
	}
}
function spliceFinishedBoards(){
	for (var i = 0; i < boardsToSplice.length; i++) {
		var board = boardsToSplice[i];

		var index = activeBoards.indexOf(board);
		if (index > -1) {
	    activeBoards.splice(index, 1);
		}
	};
}


function createBoard(boardElementID,height,width,startX,startY){
	activeBoards[activeBoards.length] = boardElementID;

	$('body').append('<div class="board" size="'+width+'x'+height+'" id="'+boardElementID+'"></div>');
	var w = 1,
			h = 1;
	while(h <= height){//height		
		w = 1;
		while(w <= width){//width
			$('#'+boardElementID).append('<div id="'+boardElementID+'-'+w+'-'+h+'" class="box off" x="'+w+'" y="'+h+'"></div>');
			w++;
		}
		$('#'+boardElementID).append('<div style="clear:both;"></div>');
		h++;
	}
	chooseStart(boardElementID,height,width,startX,startY);
}

function chooseStart(boardElementID,height,width,x,y){
	if(x == undefined){
		var x = parseInt(Math.floor((Math.random() * width) + 1));
	}
	if(y == undefined){
		var y = parseInt(Math.floor((Math.random() * height) + 1));
	}
	$('#'+boardElementID+'-'+x+'-'+y).addClass("start active on").removeClass("off");
	createActiveOpenBlockArray(boardElementID,x,y);
}

function createActiveOpenBlockArray(boardElementID,x,y){
	activeOpenBlockArray[boardElementID] = [];

	var top_y = y-1;
	if($("#"+boardElementID+"-"+x+"-"+top_y).length){
		activeOpenBlockArray[boardElementID].push(x+"-"+top_y);
	}
	var bottom_y = y+1;
	if($("#"+boardElementID+"-"+x+"-"+bottom_y).length){
		activeOpenBlockArray[boardElementID].push(x+"-"+bottom_y);
	}
	var right_x = x+1;
	if($("#"+boardElementID+"-"+right_x+"-"+y).length){
		activeOpenBlockArray[boardElementID].push(right_x+"-"+y);
	}
	var left_x = x-1;
	if($("#"+boardElementID+"-"+left_x+"-"+y).length){
		activeOpenBlockArray[boardElementID].push(left_x+"-"+y);
	}
	
}



function moveToNext(boardElementID,direction){
	var x = $('#'+boardElementID+' .active').attr('x'),
			y = $('#'+boardElementID+' .active').attr('y');

	switch(direction){
		case "up": y--;break;
		case "down": y++;break;
		case "right": x++;break;
		case "left": x--;break;
		default:console.log("moveToNext(): direction not recognized: "+direction);break;
	}
	var removeFromActiveArray = x+"-"+y,
			removeFromActiveArrayIndex = activeOpenBlockArray[boardElementID].indexOf(removeFromActiveArray);
	if(removeFromActiveArrayIndex != -1){
		activeOpenBlockArray[boardElementID].splice(removeFromActiveArrayIndex,1);
	}



	moveToThisElement = '#'+boardElementID+'-'+x+'-'+y;
	if(!$(moveToThisElement).length){
		console.log("moveToNext(): asked to move to this element but it doesn't exist: "+moveToThisElement);
		boardFinished(boardElementID);
		return;
	}
	if($(moveToThisElement).hasClass("on")){
		$(moveToThisElement).addClass("beenHereAlready");
		boardFinished(boardElementID);
	}
	if($(moveToThisElement).hasClass("start")){
		boardFinished(boardElementID);
	}

	$('#'+boardElementID+' .active').removeClass("active");
	$(moveToThisElement).addClass("active on").removeClass("off");
}



function doesBlockExist(boardElementID,x,y){
	if($("#"+boardElementID+"-"+x+"-"+y).length){
		return true;
	}
	return false;
}



function blockHasClass(className,boardElementID,x,y){
	if($("#"+boardElementID+"-"+x+"-"+y).hasClass(className)){
		return true;
	}
	return false;
}

function blockIsOpenAndExists(boardElementID,x,y,debug){
	if(doesBlockExist(boardElementID,x,y) && blockHasClass("off",boardElementID,x,y)){
		if(debug != undefined){
			console.log("Block x:"+x+" y:"+y+" exists and is open");
		}
		return true;
	}
	if(debug != undefined){
		console.log("Block x:"+x+" y:"+y+" does not exist and/or is not open");
	}
	return false;
}

function isNextToActiveBlock(boardElementID,x,y){
	for (var i = 1; i <= 4; i++) {
		if(i == 1){
			var dir = "up";
		}else if(i == 2){
			var dir = "down";
		}else if(i == 3){
			var dir = "right";
		}else if(i == 4){
			var dir = "left";
		}else{
			continue;
		} 
		var cords = moveCordsOneBlock(dir,x,y),
				cord_x = parseInt(cords['x']),
				cord_y = parseInt(cords['y']);
		if(doesBlockExist(boardElementID,cord_x,cord_y) && blockHasClass("active",boardElementID,cord_x,cord_y)){
			return  true;
		}
	};
	return false;
}




function viewBlockMoveOptions(boardElementID,x,y){
	var data = [];
	data["legitMoves"] = []; 
	for (var i = 0; i < 4; i++) {
		switch (i){
			case 0://up
				var pos = "up", cord = y,
						cordIncrementor = -1;
				break;
			case 1://down
				var pos = "down", cord = y,
						cordIncrementor = 1;
				break;	
			case 2://right
				var pos = "right"; cord = x,
						cordIncrementor = 1;
				break;
			case 3://left
				var pos = "left"; cord = x,
						cordIncrementor = -1;
				break;
			default:
				break;
		}

		data[pos] = []; 
		data[pos]['moveableAmount'] = 0;
		data[pos]['ranIntoStartBlock'] = false;
		var checkPos = cord+cordIncrementor;
		
		n = 0; 
		max = maxMoveRange(boardElementID);
		while(n <= max){
			if(i == 0 || i == 1){//up or down
				if(!blockIsOpenAndExists(boardElementID,x,checkPos) && 
					!blockHasClass("traversedBlock",boardElementID,x,checkPos))
				{

					if(blockHasClass("start",boardElementID,x,checkPos)){
						data[pos]['ranIntoStartBlock'] = true;
					}
					
					break;
				}
			}else{//right or left
				if(!blockIsOpenAndExists(boardElementID,checkPos,y) &&
					!blockHasClass("traversedBlock",boardElementID,checkPos,x))
				{

					if(blockHasClass("start",boardElementID,checkPos,y)){
						data[pos]['ranIntoStartBlock'] = true;
					}
					
					break;
				}
			}			
			data[pos]['moveableAmount']++;
			checkPos += cordIncrementor;

			if(n >= 100){
				console.log("n is too long, increase if this is not an error: "+n);
				break;
			}
			n++;
		}	
		if(data[pos]['moveableAmount'] >= 1){
			data["legitMoves"].push(pos);
		}
	};
	return data;
}

function moveCordsOneBlock(dir,x,y){
	if(dir == "up"){
		y--;
	}else if(dir == "down"){
		y++;
	}else if(dir == "right"){
		x++;
	}else if(dir == "left"){
		x--;
	}else{
		console.log("moveCordsDirection() direction not recognized: "+dir);
	}
	return {"x":x,"y":y};
}

function getOppositeDirections(dir){
	if(dir == "up"){
		var opp = "down",od1 = "right",od2 = "left";
	}else if(dir == "down"){
		var opp = "up",od1 = "right",od2 = "left";
	}else if(dir == "right"){
		var opp = "left", od1 = "up", od2 = "down";
	}else if(dir == "left"){
		var opp = "right", od1 = "up", od2 = "down";
	}else{
		console.log("getOppositeDirections() direction not recognized: "+dir); return	false;
	}
	return {"opp":opp,"od1":od1,"od2":od2};
}

function boardTotalBlocks(boardElementID){
	var size = $('#'+boardElementID).attr('size'),
			sizeArray = size.split("x"),
			widthBlocks = parseInt(sizeArray[0]),
			heightBlocks = parseInt(sizeArray[1]),
			totalBlocks = widthBlocks*heightBlocks;
	return totalBlocks;
}

function maxMoveRange(boardElementID){
	var size = $('#'+boardElementID).attr('size'),
			sizeArray = size.split("x"),
			widthBlocks = parseInt(sizeArray[0]),
			heightBlocks = parseInt(sizeArray[1]);
	if(widthBlocks > heightBlocks){
		return widthBlocks;
	}else{
		return heightBlocks;
	}
}

function percentageOfTheBoardTraversed(boardElementID){
	var totalBlocks = boardTotalBlocks(boardElementID),
			onBlocks = $('#'+boardElementID+" .on").length,
			percentage = onBlocks/totalBlocks;
	return percentage;
}

// ============================================================================================
// == General End
// ============================================================================================
// == thinkTankBrainFood Start
// ============================================================================================

function closestMove(movesArray,allowedMoves){
	bestMove = "none";
	for (var i = 1; i <= 4; i++) {
		if(i == 1){
			var pos = "up";
		}else if(i == 2){
			var pos = "down";
		}else if(i == 3){
			var pos = "right";
		}else if(i == 4){
			var pos = "left";
		}else{
			continue;
		}

		if(movesArray[pos]['moveableAmount'] == 0){
			continue;
		}
		if(allowedMoves != undefined && allowedMoves.indexOf(pos) == -1){
			continue;
		}


		if(bestMove == "none" || movesArray[pos]['moveableAmount'] < movesArray[bestMove]['moveableAmount']){
			bestMove = pos;
		}
	};
	return bestMove;
}

function isThisMoveOpenOnBothSides(boardElementID,dir,cur_x,cur_y){
	
	var nextMoveCords = moveCordsOneBlock(dir,cur_x,cur_y);

	var oppDirs = getOppositeDirections(dir);

	var od1_cords = moveCordsOneBlock(oppDirs['od1'],nextMoveCords['x'],nextMoveCords['y']);
	var od2_cords = moveCordsOneBlock(oppDirs['od2'],nextMoveCords['x'],nextMoveCords['y']);

	if(blockIsOpenAndExists(boardElementID,od1_cords["x"],od1_cords["y"]) &&
		blockIsOpenAndExists(boardElementID,od2_cords["x"],od2_cords["y"])){
		return true;
	}
	return false;
}


function startBlockIsTouchingATraverseBlockButNotThisBlock(boardElementID,x,y){
	var start_x = parseInt($("#"+boardElementID+" .start").attr("x")),
			start_y = parseInt($("#"+boardElementID+" .start").attr("y"));

	for (var i = 1; i < 4; i++) {
		if(i == 1){
			var dir = "up";
		}else if(i == 2){
			var dir = "down";
		}else if(i == 3){
			var dir = "right";
		}else if(i == 4){
			var dir = "left";
		}else{
			continue;
		}
		var cords = moveCordsOneBlock(dir,start_x,start_y),
				cord_x = parseInt(cords['x']),
				cord_y = parseInt(cords['y']);
		
		if(doesBlockExist(boardElementID,cord_x,cord_y) && 
			blockHasClass("traversedBlock",boardElementID,cord_x,cord_y) && 
			(cord_x == x && cord_y == y) )
		{
			return true;
		}
	}
	return false;
}

function traverseAllPathsIsPossible(boardElementID,block_x,block_y){

	var isPossible = false,
			openOn = "null";

	if(activeOpenBlockArray[boardElementID].length >= 2){
		isPossible = true;
		return {"boolean":isPossible,"openOn":openOn};
	}
	
	if(!activeOpenBlockArray[boardElementID][0]){
		boardFinished(boardElementID);
		return {"boolean":isPossible,"openOn":openOn};
	}	
	activeOpenBlockArray[boardElementID][0];


	var openBlockStartPosCords = activeOpenBlockArray[boardElementID][0],
			openBlockStartPosCordsSplit = openBlockStartPosCords.split("-"),
			x = parseInt(openBlockStartPosCordsSplit[0]),
			y = parseInt(openBlockStartPosCordsSplit[1]);

	if(block_x == x && block_y == y){
		openOn = "opposite";
		return {"boolean":isPossible,"openOn":openOn};
	}
	var totalOffBlocks = $("#"+boardElementID+" .off").length;
	$("#"+boardElementID+"-"+block_x+"-"+block_y).addClass("traversedBlock");

	
	$("#"+boardElementID+"-"+x+"-"+y).addClass("traversedBlock");
	var traverseBlocks = [{"x":x,"y":y}];
	while(traverseBlocks.length >= 1){
		x = traverseBlocks[0]['x'],
		y = traverseBlocks[0]['y'];
		var moveOptions = viewBlockMoveOptions(boardElementID,x,y);
		for (var m = 1; m <= 4; m++) {
			if(m == 1){
				var dir = "up";
			}else if(m == 2){
				var dir = "down";
			}else if(m == 3){
				var dir = "right";
			}else if(m == 4){
				var dir = "left";
			}else{
				continue;
			} 
			if(moveOptions[dir]['moveableAmount'] != 0){
				var newCords = moveCordsOneBlock(dir,x,y),
						new_x = newCords["x"],
						new_y = newCords["y"];

				if(!blockHasClass("traversedBlock",boardElementID,new_x,new_y) && !blockHasClass("on",boardElementID,new_x,new_y)){
					$("#"+boardElementID+"-"+new_x+"-"+new_y).addClass("traversedBlock");
					traverseBlocks.push(newCords);
				}
			}

		};
		
		traverseBlocks.shift();//remove first element
	}
	var totalTraversedBlocks = $("#"+boardElementID+" .traversedBlock").length;

	
	if(totalOffBlocks == totalTraversedBlocks){
		isPossible = true;
	}else{
		//find which side this block is open on
		for (var n = 1; n <= 4; n++) {
			if(n == 1){
				var dir = "up";
			}else if(n == 2){
				var dir = "down";
			}else if(n == 3){
				var dir = "right";
			}else if(n == 4){
				var dir = "left";
			}else{
				continue;
			} 
			var cords = moveCordsOneBlock(dir,block_x,block_y),
					cord_x = parseInt(cords['x']),
					cord_y = parseInt(cords['y']);

			if(blockIsOpenAndExists(boardElementID,cord_x,cord_y) && !blockHasClass("traversedBlock",boardElementID,cord_x,cord_y)){

				// check this block to see if it has more room to run
				// if block to right/left or top/bottom are open and right/left or 
				// top/bottom are closed do not pick this block

				//move these cords one // need to be moved to touch this block and start
				for (var i = 1; i <= 4; i++) {
					if(i == 1){
						var dir2 = "up";
					}else if(i == 2){
						var dir2 = "down";
					}else if(i == 3){
						var dir2 = "right";
					}else if(i == 4){
						var dir2 = "left";
					}else{
						continue;
					} 
					var cords2 = moveCordsOneBlock(dir2,cord_x,cord_y),
							cord_x2 = parseInt(cords2['x']),
							cord_y2 = parseInt(cords2['y']);
					if(blockIsOpenAndExists(boardElementID,cord_x2,cord_y2) && 
						!blockHasClass("traversedBlock",boardElementID,cord_x2,cord_y2) &&
						isNextToActiveBlock(boardElementID,cord_x2,cord_y2))
					{	
						break;
					}
				};
				var top_y	= cord_y2-1,
						bottom_y = cord_y2+1,
						right_x = cord_x2+1,
						left_x = cord_x2-1;

				//top//bottom//right//left
				if(blockIsOpenAndExists(boardElementID,cord_x2,top_y) && blockIsOpenAndExists(boardElementID,cord_x2,bottom_y) &&
					!blockIsOpenAndExists(boardElementID,right_x,cord_y2) && !blockIsOpenAndExists(boardElementID,left_x,cord_y2)
					){
					continue;
				}else{
				}
				//right//left//top//bottom
				if(blockIsOpenAndExists(boardElementID,right_x,cord_y2) && blockIsOpenAndExists(boardElementID,left_x,cord_y2) &&
					!blockIsOpenAndExists(boardElementID,cord_x2,top_y) && !blockIsOpenAndExists(boardElementID,cord_x2,bottom_y)
					){
					continue;
				}else{
				}

				openOn = dir;
				break;
			}
		};
		
	}
	$("#"+boardElementID+" .traversedBlock").removeClass("traversedBlock");

	
	return {"boolean":isPossible,"openOn":openOn};

}

function doHolesNeedToBeFilled(boardElementID){
	var active_x = parseInt($("#"+boardElementID+" .active").attr("x")),
			active_y = parseInt($("#"+boardElementID+" .active").attr("y"));

	for (var i = 1; i <= 4; i++) {
		if(i == 1){
			var dir = "up";
		}else if(i == 2){
			var	dir = "down";
		}else if(i == 3){
			var	dir = "right";
		}else if(i == 4){
			var	dir = "left";
		}else{
			continue;
		}
		var cords = moveCordsOneBlock(dir,active_x,active_y),
				cord_x = cords['x'],
				cord_y = cords['y'];

		if(blockIsOpenAndExists(boardElementID,cord_x,cord_y)){
			var openSideBlocks = 0;
			for (var n = 1; n <= 4; n++) {
				if(n == 1){
					var dir2 = "up";
				}else if(n == 2){
					var	dir2 = "down";
				}else if(n == 3){
					var	dir2 = "right";
				}else if(n == 4){
					var	dir2 = "left";
				}else{
					continue;
				}
				var cords = moveCordsOneBlock(dir2,cord_x,cord_y),
						cord_x2 = cords['x'],
						cord_y2 = cords['y'];

				if(blockIsOpenAndExists(boardElementID,cord_x2,cord_y2) || 
					(doesBlockExist(boardElementID,cord_x2,cord_y2) && blockHasClass("start",boardElementID,cord_x2,cord_y2))){
					openSideBlocks++;
				}

			};
			if(openSideBlocks == 1){
				return {"boolean":true,"fillHoleSide":dir};
			}
		}
	};
	return {"boolean":false};
}


// ============================================================================================
// == thinkTankBrainFood End
// ============================================================================================
// == thinkTank Start
// ============================================================================================

function thinkTank(){
	// console.log("thinkTank");
	// console.log(activeBoards);
	if(activeBoards.length == 0){
		clearInterval(thinkTankLoop_timer);
		thinkTankLoop_timer = 0;
		return;
	}

	for (var i = 0; i < activeBoards.length; i++) {


		var boardElementID = activeBoards[i],
				x = parseInt($('#'+boardElementID+" .active").attr('x')),
				y = parseInt($('#'+boardElementID+" .active").attr('y'));

		
		var moveOptions = viewBlockMoveOptions(boardElementID,x,y);
		
		var bestMove = "none";
		// if no moves, ya done
		// if one move, it's obvious
		if(moveOptions["legitMoves"].length == 0){
			for (var i = 1; i <= 4; i++) {
				if(i == 1){
					var pos = "up";
				}else if(i == 2){
					var pos = "down";
				}else if(i == 3){
					var pos = "right";
				}else if(i == 4){
					var pos = "left";
				}else{
					console.log('thinkTank():'+boardElementID+': has no where to move, finished');
					boardFinished(boardElementID);
					continue;
				}
				if(moveOptions[pos]['ranIntoStartBlock']){
					bestMove = pos;
					$('#'+boardElementID+" .start").removeClass("on").addClass("off");
				}
			};
		}else if(moveOptions["legitMoves"].length == 1){
			bestMove = moveOptions["legitMoves"][0];
		}

		var doHolesExist = doHolesNeedToBeFilled(boardElementID);
		if(doHolesExist['boolean']){
			bestMove = doHolesExist['fillHoleSide'];
		}



		if(bestMove == "none"){
			var bestMoveToPickFromArray = [];

			var active_x = parseInt($("#"+boardElementID+" .active").attr('x')),
					active_y = parseInt($("#"+boardElementID+" .active").attr('y'));

			for (var i = 0; i < moveOptions['legitMoves'].length; i++) {
				var pos = moveOptions['legitMoves'][i];


				var cords = moveCordsOneBlock(pos,active_x,active_y),
						x = parseInt(cords['x']),
						y = parseInt(cords['y']);

				var result = traverseAllPathsIsPossible(boardElementID,x,y);
				if(result['boolean'] == false){//openOn
					var openOn = result['openOn'];
					
					if(openOn == "opposite"){
						var opposites = getOppositeDirections(pos),
								openOn = opposites['opp'];
					}

					if(moveOptions['legitMoves'].indexOf(openOn) != -1){
						bestMove = openOn;
						break;
					}
				}else{
					bestMoveToPickFromArray.push(pos);
				}
			};

			if(bestMove == "none"){
				bestMove = closestMove(moveOptions,bestMoveToPickFromArray);
			}

		}
	
		moveToNext(boardElementID,bestMove);
	};
	spliceFinishedBoards();
}




// ============================================================================================
// == thinkThank End
// ============================================================================================
// == Operators and inits Start
// ============================================================================================



thinkTankLoop_timer = 0;
function thinkTankLoop(){
	if(thinkTankLoop_timer == 0){
		thinkTankLoop_timer = 1;
		thinkTankLoop_timer = setInterval(function(){ 
			thinkTank();
		}, 200);
	}else{
		clearInterval(thinkTankLoop_timer);
		thinkTankLoop_timer = 0;
	}
}







activeBoards = [];

var height = 8,
		width = 8;


// createBoard("alpha",height,width,5,3);//broken
// createBoard("alpha2",height,width,1,2);//broken
// createBoard("alpha",height,width,4,6);//broken
createBoard("alpha",height,width,3,8);//crashes


// for (var i = 0; i < 1; i++) {
// 	var foo = "place"+i;
// 	createBoard(foo,height,width);
// };


$(document).on("click",'.board',function(){
	if($(this).hasClass("selected")){
		$('.board').removeClass("selected");
		return;
	}
	$('.board').removeClass("selected");
	$(this).addClass("selected");	
});
window.addEventListener("keydown", function(e) {
    if([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {
        e.preventDefault();
    }
}, false);

$('#new').on("click",function(){
	$('.board').remove();
	activeBoards = [];
	activeOpenBlockArray = [];
	boardsToSplice = [];
	createBoard(foo,height,width);
});
$('#playButton').on("click",function(){
	thinkTankLoop();
});

$('body').on("keyup",function(e){
	// console.log("received key: "+e.keyCode);
	switch(e.keyCode){
		case 32://space
			var direction = "space";
			break;
		case 93://command
			var direction = "command";
			break;
		case 39://right
			var direction = "right",
					selected = $('.selected').attr("id");
			break;
		case 37://left
			var direction = "left",
					selected = $('.selected').attr("id");
			break;
		case 38://up
			var direction = "up",
					selected = $('.selected').attr("id");
			break;
		case 40://down
			var direction = "down",
					selected = $('.selected').attr("id");
			break;
		default:
			return;
			break;
	}
	if(direction == "command"){
		thinkTank();
		return;
	}
	if(direction == "space"){
		thinkTankLoop();
		return;
	}
	if($('.selected').length){
		moveToNext(selected,direction);
	}
	
});





</script>
</html>














</script>
</html>
